<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"><title>Usuarios</title>
<meta name="robots" content="noindex, nofollow"><meta name="googlebot" content="noindex, nofollow">
<link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
</head>
<body>
  <header>
    <div class="brand">
      <img src="{{ url_for('static', filename='img/imagotipo-PUCP.png') }}" alt="PUCP">
      <h1>Administración de usuarios</h1>
    </div>
    <div class="header-actions">
      <span class="badge-admin">Admin</span>
      <a href="{{ url_for('index') }}">Inicio</a>
      <a href="{{ url_for('logout') }}">Salir</a>
    </div>
  </header>

  <div class="layout">
    <div class="left-panel">
      <h2>Crear usuario</h2>
      {% if error %}<div class="err">{{ error }}</div>{% endif %}
      <form method="POST">
        <label for="username">Usuario</label>
        <input id="username" name="username" required>
        <label for="password">Contraseña</label>
        <input id="password" name="password" type="password" required>
        <label for="role">Rol</label>
        <select id="role" name="role">
          <option value="visitor">Visitor (solo lectura)</option>
          <option value="admin">Admin (prestar/devolver)</option>
        </select>
        <button type="submit">Guardar</button>
      </form>
    </div>

    <div class="right-panel">
      <h2>Usuarios</h2>
      <table>
        <thead><tr><th>Usuario</th><th>Rol</th><th>Acciones</th></tr></thead>
        <tbody>
          {% for u in users %}
            <tr>
              <td>{{ u.username }}</td>
              <td>{{ 'Admin' if u.role=='admin' else 'Visitor' }}</td>
              <td>
                {% if u.username not in ['admin', current_user] %}
                  <form method="POST" action="{{ url_for('delete_user', username=u.username) }}" onsubmit="return confirm('Eliminar {{u.username}}?')" style="display:inline;">
                    <button class="secondary" type="submit">Eliminar</button>
                  </form>
                {% else %}
                  <span style="color:#666">—</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>