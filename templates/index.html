<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Inventario PUCP</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #F9FAFB;
    color: #333;
    margin: 0;
    padding: 30px;
  }
  header {
    display: flex;
    align-items: center;
    border-bottom: 3px solid #002C77;
    padding-bottom: 15px;
    margin-bottom: 25px;
  }
  header img {
    height: 60px;
    margin-right: 20px;
  }
  h1 {
    color: #002C77;
    margin: 0;
  }
  h2 {
    margin-top: 0;
    color: #444;
  }
  form { margin-bottom: 20px; }
  select, input {
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #ccc;
    margin-right: 10px;
  }
  button {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    color: white;
    background: #0072CE;
  }
  button:hover { background: #005BB5; }
  .table-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    width: fit-content;
  }
  table {
    border-collapse: collapse;
    width: 100%;
  }
  th, td {
    text-align: left;
    padding: 8px 10px;
    border-bottom: 1px solid #ddd;
  }
  th {
    background: #E9ECF5;
    text-transform: uppercase;
  }
  .estado {
    font-weight: bold;
  }
  .disponible { color: green; }
  .prestado { color: #B00020; }
</style>
</head>
<body>
  <header>
    <img src="https://red.pucp.edu.pe/riel/files/2019/07/LOGO-DE-PUCP.jpg" alt="PUCP">
    <h1>ALMACÉN DE ELECTRICIDAD Y ELECTRÓNICA</h1>
  </header>

  <h2>Datos técnicos del inventario</h2>

  <form method="get" action="/">
    <label for="codigo">Buscar por código:</label>
    <input type="text" id="codigo" name="codigo" placeholder="Ej. A-01-3ALMINS000037">
    <button type="submit">Buscar</button>
  </form>
  
  <form method="get" action="/buscar">
    <label for="desc">Buscar por descripción:</label>
    <input type="text" id="desc" name="desc" placeholder="Ej. osciloscopio, fuente, multímetro">
    <button type="submit">Buscar</button>
  </form>

  {% if result %}
    {% if result.no_agregado %}
      <div style="background:#FFE5E5; color:#B00020; padding:15px; border-radius:6px; width:fit-content;">
        <strong>{{ result.mensaje }}</strong>
      </div>
      <button onclick="window.location.href='/'" style="margin-top:15px;">← Regresar al inicio</button>
    {% else %}
      <div class="table-container">
        <table>
          {% for key, value in result.items() %}
            {% if key not in ['Link', 'Documento', 'no_agregado', 'mensaje'] %}
              <tr>
                <th>{{ key.upper() }}</th>
                <td>
                  {% if key == 'Estado' %}
                    <span class="estado {{ 'disponible' if value == 'Disponible' else 'prestado' }}">
                      {{ value }}
                    </span>
                  {% else %}
                    {{ value if value not in [None, 'nan', 'NaN'] else '-' }}
                  {% endif %}
                </td>
              </tr>
            {% endif %}
          {% endfor %}
        </table>

        {% if result.Estado == 'Disponible' %}
          <form action="/prestar/{{ result['Codigo'] }}" method="get" style="margin-top:15px;">
            <button>Prestar</button>
          </form>
        {% elif result.Estado == 'Prestado' %}
          <form action="/devolver/{{ result['Codigo'] }}" method="get" style="margin-top:15px;">
            <button>Devolver</button>
          </form>
        {% endif %}
      </div>

      {% if result.Documento %}
        <div style="margin-top:25px;">
          <h3>Documento asociado</h3>
          {{ result.Documento|safe }}
        </div>
      {% endif %}
    {% endif %}
  {% endif %}
</body>
</html>
