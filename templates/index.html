<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Inventario PUCP</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #F2F2F2; color: #333; }
  header { background-color: #002C77; padding: 20px; display: flex; align-items: center; color: white; }
  header img { height: 60px; margin-right: 20px; }
  h1 { font-size: 1.8em; margin: 0; }
  h2.subtitle { font-size: 1.2em; font-weight: normal; color: #dbe4ff; margin: 5px 0 0 0; }
  main { padding: 40px; }
  form { margin-bottom: 20px; width: 380px; }
  input, button { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
  input { width: 260px; }
  button { background: #0072CE; color: white; cursor: pointer; }
  button:hover { background: #005BB5; }
  table { border-collapse: collapse; margin-top: 20px; width: 95%; background: white; border-radius: 6px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  th, td { border: 1px solid #ccc; padding: 10px; vertical-align: top; text-align: left; }
  th { background-color: #E9ECF5; text-transform: uppercase; letter-spacing: 0.5px; width: 25%; }
  .doc-section { margin-top: 40px; }
  .stats { background: white; border-radius: 6px; padding: 10px 20px; width: fit-content; box-shadow: 0 1px 5px rgba(0,0,0,0.1); margin-bottom: 30px; }
  .stats strong { color: #002C77; }
</style>
</head>
<body>
  <header>
    <img src="https://red.pucp.edu.pe/riel/files/2019/07/LOGO-DE-PUCP.jpg" alt="PUCP">
    <div>
      <h1>ALMACÉN DE ELECTRICIDAD Y ELECTRÓNICA</h1>
      <h2 class="subtitle">DATOS TÉCNICOS</h2>
    </div>
  </header>

  <main>
    <div class="stats">
      <strong>Resumen:</strong>
      {{ stats.con_codigo_link }} con código y link ·
      {{ stats.con_codigo }} con código ·
      {{ stats.sin_codigo }} sin código ·
      Total: {{ stats.total }}
    </div>

    <!-- BÚSQUEDA POR CÓDIGO -->
    <form id="searchForm">
      <input list="codigos" id="codigo" placeholder="Seleccionar código" required>
      <datalist id="codigos">
        {% for c in codigos %}
          <option value="{{ c }}">
        {% endfor %}
      </datalist>
      <button type="submit">Buscar</button>
    </form>

    <!-- BÚSQUEDA POR DESCRIPCIÓN -->
    <form id="descForm" action="/buscar" method="get">
      <input list="descripciones" id="desc" name="desc" placeholder="Seleccionar descripción" required>
      <datalist id="descripciones">
        {% for d in descripciones %}
          <option value="{{ d }}">
        {% endfor %}
      </datalist>
      <button type="submit">Buscar</button>
    </form>

    <!-- RESULTADO DE BÚSQUEDA -->
    {% if result %}
      {% if result is string %}
        <p><strong>{{ result }}</strong></p>
      {% else %}
        <table>
          {% for key, value in result.items() %}
            {% if key not in ['Link', 'Documento'] %}
              <tr>
                <th>{{ key.upper() }}</th>
                <td>{{ value if value not in [None, 'nan', 'NaN'] else '-' | safe }}</td>
              </tr>
            {% endif %}
          {% endfor %}
        </table>
        {% if result.Documento %}
          <div class="doc-section">
            <h3>DOCUMENTO INCRUSTADO</h3>
            {{ result.Documento|safe }}
          </div>
        {% endif %}
      {% endif %}
    {% endif %}
  </main>

  <script>
    const codeForm = document.getElementById('searchForm');
    codeForm.addEventListener('submit', e => {
      e.preventDefault();
      const code = document.getElementById('codigo').value.trim();
      if (code) window.location.href = '/' + encodeURIComponent(code);
    });
  </script>
</body>
</html>
